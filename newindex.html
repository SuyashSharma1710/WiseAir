<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Air Finery - The Art of Atmosphere</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700;900&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --color-primary: #10b981; /* Emerald 500 */
        --color-secondary: #0a0a0a; /* Near Black */
        --color-light: #f1f5f9; /* Slate 100 */
        --color-text-dark: #a1a1aa; /* Zinc 400 */
        --color-text-light: #18181b; /* Zinc 900 */
      }

      body {
        font-family: "Inter", sans-serif;
        background-color: var(--color-secondary);
        color: var(--color-text-dark);
        overflow-x: hidden;
      }

      /* --- Global Elements --- */
      #webgl-canvas {
        position: fixed;
        top: 0;
        left: 0;
        outline: none;
        z-index: 1; /* Behind text but above background */
      }

      .content-section {
        position: relative;
        z-index: 2; /* Text is above the canvas */
        min-height: 100vh;
        width: 100%;
        display: flex;
        align-items: center;
        padding: 4rem 1.5rem;
        color: white;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
      }

      .content-box {
        max-width: 28rem; /* Narrower for side alignment */
        opacity: 0;
        transform: translateY(30px);
        transition: opacity 0.8s ease-out, transform 0.8s ease-out;
      }

      .content-box.is-visible {
        opacity: 1;
        transform: translateY(0);
      }

      .justify-center {
        justify-content: center;
      }
      .justify-start {
        justify-content: flex-start;
      }
      .justify-end {
        justify-content: flex-end;
      }
      .text-center {
        text-align: center;
      }
      .text-left {
        text-align: left;
      }

      .light-section {
        background-color: #ffffff;
        color: var(--color-text-light);
        text-shadow: none;
      }

      .section-heading {
        font-size: clamp(2.5rem, 6vw, 4rem);
        font-weight: 900;
        line-height: 1.1;
        letter-spacing: -0.025em;
      }

      .section-subheading {
        font-size: clamp(1.125rem, 2vw, 1.25rem);
        margin-top: 1.5rem;
        max-width: 42rem;
      }

      /* --- Preloader --- */
      #preloader {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: var(--color-secondary);
        z-index: 1000;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        transition: opacity 0.5s ease-in-out;
      }
      #preloader.loaded {
        opacity: 0;
        pointer-events: none;
      }
    </style>
  </head>
  <body>
    <div id="preloader">
      <div class="text-white text-2xl font-bold tracking-widest">AIRFINERY</div>
    </div>

    <canvas id="webgl-canvas"></canvas>

    <div id="content-container">
      <!-- Section 1: Hero -->
      <section id="section-hero" class="content-section justify-center">
        <div class="content-box text-center">
          <h1 class="section-heading">Define Your Atmosphere</h1>
          <p class="section-subheading text-zinc-400 mx-auto">
            A revolutionary approach to air purification. We combine German
            engineering with sophisticated design to create healthier, more
            productive, and prestigious environments.
          </p>
        </div>
      </section>

      <!-- Section 2: The Problem -->
      <section id="section-problem" class="content-section justify-start">
        <div class="content-box text-left">
          <h2 class="section-heading">The Invisible Compromise</h2>
          <p class="section-subheading text-zinc-400">
            Your space is constantly infiltrated by microscopic pollutants. This
            unseen threat impacts wellness, perception, and performance,
            silently defining the experience of everyone who enters.
          </p>
        </div>
      </section>

      <!-- Section 3: The Solution -->
      <section id="section-solution" class="content-section justify-end">
        <div class="content-box text-left">
          <h2 class="section-heading">
            <span class="text-emerald-400">Purity</span>, Engineered.
          </h2>
          <p class="section-subheading text-zinc-400">
            The AirFinery unit is more than a purifier; it's a statement of
            quality. As you scroll, explore the technology that sets a new
            standard for clean air.
          </p>
        </div>
      </section>
    </div>

    <script type="importmap">
      {
        "imports": {
          "three": "https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.module.js",
          "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.128.0/examples/jsm/"
        }
      }
    </script>

    <script type="module">
      import * as THREE from "three";
      import { GLTFLoader } from "three/addons/loaders/GLTFLoader.js";

      // --- Preloader ---
      const preloader = document.getElementById("preloader");
      const contentBoxes = document.querySelectorAll(".content-box");

      window.onload = function () {
        setTimeout(() => {
          if (preloader) preloader.classList.add("loaded");
          if (contentBoxes.length > 0)
            contentBoxes[0].classList.add("is-visible");
        }, 500);
      };
      setTimeout(() => {
        if (preloader && !preloader.classList.contains("loaded"))
          preloader.classList.add("loaded");
      }, 4000);

      // --- Scene Setup ---
      const scene = new THREE.Scene();
      const camera = new THREE.PerspectiveCamera(
        75,
        window.innerWidth / window.innerHeight,
        0.1,
        1000
      );
      camera.position.z = 5;
      const renderer = new THREE.WebGLRenderer({
        canvas: document.getElementById("webgl-canvas"),
        antialias: true,
        alpha: true,
      });
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));

      // --- Lighting ---
      const ambientLight = new THREE.AmbientLight(0xffffff, 0.8);
      scene.add(ambientLight);
      const directionalLight = new THREE.DirectionalLight(0xffffff, 1.5);
      directionalLight.position.set(5, 5, 5);
      scene.add(directionalLight);

      // --- GLB Model Loading ---
      const gltfLoader = new GLTFLoader();
      let model = null;
      let fan, filter1, filter2;

      const modelURL =
        "https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/DamagedHelmet/glTF-Binary/DamagedHelmet.glb";

      gltfLoader.load(
        modelURL,
        (gltf) => {
          model = gltf.scene;
          model.scale.set(1.5, 1.5, 1.5);
          model.position.y = -1;

          fan = model.getObjectByName("Fan_Assembly");
          filter1 = model.getObjectByName("Filter_Pleated");
          filter2 = model.getObjectByName("Filter_Carbon");

          scene.add(model);
        },
        undefined,
        (error) => {
          console.error("An error happened while loading the model.", error);
        }
      );

      // --- Interactivity & Scroll Logic ---
      const sections = document.querySelectorAll(".content-section");
      let scrollY = window.scrollY;
      let currentSection = 0;
      const sizes = { width: window.innerWidth, height: window.innerHeight };
      const mouse = new THREE.Vector2();

      window.addEventListener("scroll", () => {
        scrollY = window.scrollY;
        const newSection = Math.round(scrollY / sizes.height);
        if (newSection !== currentSection) {
          currentSection = newSection;
          contentBoxes.forEach((box, index) => {
            box.classList.toggle("is-visible", index === currentSection);
          });
        }
      });

      window.addEventListener("mousemove", (event) => {
        mouse.x = (event.clientX / sizes.width) * 2 - 1;
        mouse.y = -(event.clientY / sizes.height) * 2 + 1;
      });

      const clock = new THREE.Clock();
      const tick = () => {
        const elapsedTime = clock.getElapsedTime();
        const scrollPercent = (scrollY % sizes.height) / sizes.height;

        if (model) {
          // Default state for parts
          if (fan) fan.position.z = 0;
          if (filter1) filter1.position.z = 0;
          if (filter2) filter2.position.z = 0;

          let targetX = 0;
          let targetY = -1;

          if (currentSection === 0) {
            targetX = 0; // Center
          } else if (currentSection === 1) {
            targetX = 3.5; // Right
          } else if (currentSection === 2) {
            targetX = -3.5; // Left
          } else {
            targetY = 10; // Move up and out of view
          }

          // Smoothly interpolate position
          model.position.x += (targetX - model.position.x) * 0.05;
          model.position.y += (targetY - model.position.y) * 0.05;

          // Section 2: Purity, Engineered - Explode Animation
          if (currentSection === 2) {
            const progress = scrollPercent;
            if (fan) fan.position.z = progress * 1.5;
            if (filter1) filter1.position.z = -progress * 1;
            if (filter2) filter2.position.z = -progress * 1.5;
          }

          // Continuous rotation based on overall scroll
          let overallProgress = scrollY / (sizes.height * 3); // Rotate over first 3 sections
          const scrollRotationY = Math.PI * 2 * overallProgress;

          // Add mouse parallax effect on top of scroll animation
          const targetRotationX = mouse.y * 0.2;
          const targetRotationY = scrollRotationY + mouse.x * 0.2;
          model.rotation.x += (targetRotationX - model.rotation.x) * 0.05;
          model.rotation.y += (targetRotationY - model.rotation.y) * 0.05;
        }

        renderer.render(scene, camera);
        window.requestAnimationFrame(tick);
      };

      tick();

      window.addEventListener("resize", () => {
        sizes.width = window.innerWidth;
        sizes.height = window.innerHeight;
        camera.aspect = sizes.width / sizes.height;
        camera.updateProjectionMatrix();
        renderer.setSize(sizes.width, sizes.height);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
      });
    </script>
  </body>
</html>
